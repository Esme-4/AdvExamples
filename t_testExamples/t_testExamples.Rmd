---
title: "Two-sample testing"
author: "F.A. Barrios"
date: "`r Sys.Date()`"
output:
  rmdformats::robobook:
    highlight: kate
---
```{r setup, include=FALSE}
## Global options
knitr::opts_chunk$set(cache = TRUE)
```

```{r}
library(tidyverse)
library(emmeans)
library(rstatix)
library(WRS2)
```
# Two-sample testing, t-test examples

## Non-parametric examples

The comparison of tow populations using t-test

**Example 1** The purpose of a study by Tam et al. was to investigate wheelchair maneuvering in individuals with lower-level spinal cord injury (SCI) and healthy controls (C). Subjects used a modified wheelchair to incorporate a rigid seat surface to facilitate the specified experimental measurements. Interface pressure measurement was recorded by using a high-resolution pressure-sensitive mat with a spatial resolution of four sensors per square centimeter taped on the rigid seat support. During static sitting conditions, average pressures were recorded under the ischial tuberosities (the bottom part of the pelvic bones). The data for measurements of the left ischial tuberosity (in mm Hg) for the SCI and control groups are shown in EXA_C07_S03_02.csv. We wish to know if we may conclude, on the basis of these data, that, in general, healthy subjects exhibit lower pressure than SCI subjects.

*Result* We are going to run two solutions, there is a parametric solution using R's 't.test()' in my [Statistics course page](https://fabarrios.github.io/ProbEstad/Hipotesis/Hipotesis.html), here we are going to use the rstatix for non-parametric solution and WRS2 for a robust solution.  First to use the pipeline structure in rstatix we need to wrangle the data.

```{r}

SCI_con <- read_csv("~/DropBox/GitHub/ProbEstad/DataSets/ch07_all/EXA_C07_S03_02.csv", show_col_types = FALSE)

SCI_long <- SCI_con %>% 
  pivot_longer(cols = everything(), names_to = "Group", values_to = "Pressure")

SCI_long <- SCI_long %>% 
  mutate( Group = factor(Group) )

SCI_long <- SCI_long %>% 
  mutate( Group = Group %>% fct_relevel("CONTROL","SCI") )

ggplot(SCI_long, aes(x = Group, y = Pressure, color = Group)) +
  geom_boxplot() +
  geom_jitter(height = .1, width = .1)

SCL_wilcox <- wilcox_test(SCI_long, Pressure ~ Group, p.adjust.method = "holm", paired = FALSE, alternative = "less", conf.level = 0.95) %>%
  add_significance()

SCL_wilcox

SCI_long %>% wilcox_effsize(Pressure ~ Group)
```

this answer for the estimate falls in the non-rejection region, the two groups are not different.

**Example 2** Can we conclude that patients with primary hypertension (PH), on the average, have higher total cholesterol levels than normotensive (NT) patients? This was one of the inquiries of interest for Rossi et al. In the table in EXR_C07_S03_04.csv there are total cholesterol measurements (mg/dl) for 133 PH patients and 41 NT patients. Can we conclude that PH patients have, on average, higher total cholesterol levels than NT patients? Let $\alpha = .05$.  

```{r}
Hyper <- read_csv("~/DropBox/GitHub/ProbEstad/DataSets/ch07_all/EXR_C07_S03_04.csv", show_col_types = FALSE)

```

We have the data format in long format so we can do "data and formula", nevertheless we need to "factor" the data and the levels are fine (1, 2) making the hypertensive the 1 = HT and the normotensive 2 = NT.

```{r}
Hyper <- Hyper %>% rename(Cholesterol = Length)

Hyper_n <- Hyper %>% mutate(Group = case_when(
  Group == 1 ~ "HT",
  Group == 2 ~ "NT"
))

Hyper_n <- Hyper_n %>% 
  mutate( Group = factor(Group) )

ggplot(Hyper_n, aes(x = Group, y = Cholesterol, color = Group)) +
  geom_boxplot() +
  geom_jitter(height = .1, width = .1)
```

We start this example estimating a parametric t-test, from rstatix, to use the same data format for the non-parametric test. Then we run the Wilconxon test from rstatix. Finally, in the robust statistical estimates section we use a yuen test and other examples.

```{r}
Hyper_t_test <- t_test(Hyper_n, Cholesterol ~ Group, p.adjust.method = "holm", paired = FALSE, alternative = "less", conf.level = 0.95) %>% add_significance()
Hyper_t_test

# And the non-parametric example
Hyper_wilcox <- wilcox_test(Hyper_n, Cholesterol ~ Group, p.adjust.method = "holm", paired = FALSE, alternative = "less", conf.level = 0.95) %>% add_significance()
Hyper_wilcox

```


## Robust statisticlal Methods

Now for the **Example 1** we use a  robust statistic test for a two-sample trimmed mean test from the WRS2 package, the `yuen` test and the bootstrap version too `yuenbt`

```{r}

SCL_yuen <- yuen(Pressure ~ Group, data = SCI_long)
SCL_yuen
# for effect size
akp.effect(Pressure ~ Group, data = SCI_long)

set.seed(123)
yuen.effect.ci(Cholesterol ~ Group, data = Hyper_n)
```

For the **Example 2** we use a yuen test and other robust tests that may correct for outliers o "large" values.

```{r}
Hyper_yuen <- yuen(Cholesterol ~ Group, data = Hyper_n)
Hyper_yuen
# Effect size
akp.effect(Cholesterol ~ Group, data = Hyper_n)

```
